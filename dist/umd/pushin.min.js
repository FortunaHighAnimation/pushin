!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).pushin={})}(this,(function(t){"use strict";class e{constructor(t,e){var s;this.container=t,this.breakpoints=[],this.scrollPos=0,this.scrollEnd=null,this.touchStart=null,this.pageHeight=null,this.layers=[],this.speedDelta=100,this.transitionLength=200,this.layerDepth=1e3,this.debug=null!==(s=null==e?void 0:e.debug)&&void 0!==s&&s}start(){this.container?(this.addScene(),this.scrollPos=window.pageYOffset,this.setBreakpoints(),this.getLayers(),this.setScrollLength(),this.bindEvents(),this.toggleLayers()):console.error("No container element provided to pushIn.js. Effect will not be applied."),this.debug&&this.showDebugger()}addScene(){const t=this.container.querySelector(".pushin-scene");t?this.scene=t:(this.scene=document.createElement("div"),this.scene.classList.add("pushin-scene"),this.scene.innerHTML=this.container.innerHTML,this.container.innerHTML="",this.container.appendChild(this.scene))}setBreakpoints(){this.breakpoints=[768,1440,1920],this.scene.dataset.pushinBreakpoints&&(this.breakpoints=this.scene.dataset.pushinBreakpoints.split(",").map((t=>parseInt(t.trim(),10)))),this.breakpoints.unshift(0)}getLayers(){const t=Array.from(this.container.getElementsByClassName("pushin-layer"));for(let e=0;e<t.length;e++){const s=t[e],n=this.getInpoints(s,e),i=this.getOutpoints(s,n[0]),o={element:s,index:e,originalScale:this.getElementScaleX(s),ref:{inpoints:n,outpoints:i},params:{inpoint:this.getInpoint(n),outpoint:this.getOutpoint(i),speed:this.getSpeed(s)}};this.layers.push(o),this.setZIndex(o,t.length)}}getInpoints(t,e){const{top:s}=this.scene.getBoundingClientRect();let n=[s];if(t.dataset.pushinFrom)n=t.dataset.pushinFrom.split(",").map((t=>parseInt(t.trim(),10)));else if(0===e&&this.scene.dataset.pushinFrom)n=this.scene.dataset.pushinFrom.split(",").map((t=>parseInt(t.trim(),10)));else if(e>0){const{outpoint:t}=this.layers[e-1].params;n=[t-this.speedDelta]}return n}getOutpoints(t,e){let s=[e+this.layerDepth];if(t.dataset.pushinTo){s=t.dataset.pushinTo.split(",").map((t=>parseInt(t.trim(),10)))}return s}getSpeed(t){let e=null;return t.dataset.pushinSpeed&&(e=parseInt(t.dataset.pushinSpeed,10),Number.isNaN(e)&&(e=8)),e||8}getBreakpointIndex(){const t=this.breakpoints.reverse().findIndex((t=>t<=window.innerWidth));return-1===t?0:this.breakpoints.length-1-t}setZIndex(t,e){t.element.style.zIndex=(e-t.index).toString()}bindEvents(){let t;window.addEventListener("scroll",(()=>{this.scrollPos=window.pageYOffset,this.dolly()})),window.addEventListener("touchstart",(t=>{this.touchStart=t.changedTouches[0].screenY})),window.addEventListener("touchmove",(t=>{t.preventDefault();const e=t.changedTouches[0].screenY;this.scrollPos=Math.max(this.scrollEnd+this.touchStart-e,0),this.scrollPos=Math.min(this.scrollPos,this.pageHeight-window.innerHeight),this.dolly()})),window.addEventListener("touchend",(()=>{this.scrollEnd=this.scrollPos})),window.addEventListener("resize",(()=>{clearTimeout(t),t=window.setTimeout((()=>{this.resetLayerParams(),this.setScrollLength(),this.toggleLayers()}),300)}))}resetLayerParams(){this.layers.forEach((t=>{t.params={inpoint:this.getInpoint(t.ref.inpoints),outpoint:this.getOutpoint(t.ref.outpoints),speed:this.getSpeed(t.element)}}))}getElementScaleX(t){const e=window.getComputedStyle(t).getPropertyValue("transform");let s=1;if(e&&"none"!==e){const t=e.match(/[matrix|scale]\(([\d,.\s]+)/);if(t&&t[1]){const e=t[1].split(", ");s=parseFloat(e[0])}}return s}dolly(){requestAnimationFrame((()=>{this.toggleLayers()}))}toggleLayers(){this.layers.forEach((t=>this.setLayerStyle(t)))}isActive(t){const{inpoint:e}=t.params,{outpoint:s}=t.params;return this.scrollPos>=e&&this.scrollPos<=s}getInpoint(t){return t[this.getBreakpointIndex()]||t[0]}getOutpoint(t){return t[this.getBreakpointIndex()]||t[0]}getScaleValue(t){const e=(this.scrollPos-t.params.inpoint)*(Math.min(t.params.speed,100)/100)/100;return Math.max(t.originalScale+e,0)}setScale({style:t},e){const s=`scale(${e})`;t.webkitTransform=s,t.mozTransform=s,t.msTransform=s,t.oTransform=s,t.transform=s}setLayerStyle(t){let e=0;const s=0===t.index,n=t.index+1===this.layers.length,{inpoint:i}=t.params,{outpoint:o}=t.params;if(s&&this.scrollPos<i)e=1;else if(n&&this.scrollPos>o)e=1;else if(this.isActive(t)){this.setScale(t.element,this.getScaleValue(t));let r=Math.max(Math.min(this.scrollPos-i,this.transitionLength),0)/this.transitionLength;s&&(r=1);let a=Math.max(Math.min(o-this.scrollPos,this.transitionLength),0)/this.transitionLength;n&&(a=1),e=Math.min(r,a)}t.element.style.opacity=e.toString()}setScrollLength(){const t=getComputedStyle(this.container).height.replace("px",""),e=(this.layers.length-1)*this.speedDelta,s=this.layers.length*(this.layerDepth+this.transitionLength);this.container.style.height=`${Math.max(parseFloat(t),s-e)}px`}showDebugger(){const t=document.createElement("div");t.classList.add("pushin-debug");const e=document.createElement("p");e.innerText="Pushin.js Debugger",e.classList.add("pushin-debug__title");const s=document.createElement("div");s.classList.add("pushin-debug__content"),s.innerText=`Scroll position: ${window.pageYOffset}px`,t.appendChild(e),t.appendChild(s),document.body.appendChild(t),window.addEventListener("scroll",(()=>{s.innerText=`Scroll position: ${Math.round(window.pageYOffset)}px`}))}}window.pushInStart=t=>{let s,n=".pushin";t&&("string"==typeof t?n=t:s=t);const i=document.querySelectorAll(n);for(const t of i)new e(t,s).start()},t.PushIn=e,Object.defineProperty(t,"__esModule",{value:!0})}));
